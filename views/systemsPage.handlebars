<main>
	<script src="/templates/system_item_template.js" defer></script>
	<script>
		function modalHide() {
			document.getElementById(MODAL_BACKDROP_ID).classList.add("hidden");
			document.getElementById(MODAL_ID).classList.add("hidden");
		}

		function modalShow() {
			document.getElementById(MODAL_BACKDROP_ID).classList.remove("hidden");
			document.getElementById(MODAL_ID).classList.remove("hidden");
			setupStarfield();
		}

		function modalOpen() {
			modalShow();
		}

		function modalCancel() {
			modalHide();
		}

		function modalAccept() {
			var creationForm = document.forms["modal-form"];
			var systemContext = {
				name: creationForm["system-name"].value,
				star_count: creationForm["star-count"].value,
				orbital_radius: creationForm["system-orbital-radius"].value,
				theta: creationForm["system-theta"].value
			};
			postToServer("/systems/add", systemContext);
			var systemHTML = Handlebars.templates.systemItem(systemContext);
			document.getElementById("systems-list").insertAdjacentHTML("beforeend", systemHTML);

			modalHide();
		}

		window.addEventListener("DOMContentLoaded", function() {
			document.getElementById(MODAL_OPEN_BUTTON_ID).addEventListener("click", modalOpen);
			document.getElementById(MODAL_CANCEL_BUTTON_ID).addEventListener("click", modalCancel);
			document.getElementById(MODAL_ACCEPT_BUTTON_ID).addEventListener("click", modalAccept);
		});
	</script>
	<div>
        <button type="button" id="modal-open-button">Create New System</button>
    </div>
    <br>
    <table id="systems-list">
        <tr>
            <th>Name</th>
            <th>Star Count</th>
            <th>Orbital Radius</th>
            <th>Theta</th>
        </tr>
        {{#each systems}}
			{{> systemItem}}
		{{/each}}
    </table>
	<div id="modal-backdrop" class="hidden">
        <canvas id="starfield" class="starfield"></canvas>
    </div>
	<div id="modal" class="hidden">
		<div id="modal-dialog">
            <h2>Create New System</h2>
			<form name="modal-form">
                <table>
                    <tr>
                        <td>
                            <label>Name:</label>
                        </td>
                        <td>
                            <input type="text" id="system-name" name="system-name">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label>Star Count:</label>
                        </td>
                        <td>
                            <input type="number" id="star-count" name="star-count" min="1" max="3" value="1">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label>Orbital Radius:</label>
                        </td>
                        <td>
                            <input type="number" id="system-orbital-radius" name="system-orbital-radius" min="0.1" max="1.0" value=".5" step="0.01">
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label>Theta:</label>
                        </td>
                        <td>
                            <input type="number" id="system-theta" name="system-theta" min="0" max="360" value="0">
                        </td>
                    </tr>
                </table>
			</form>
			<button id="modal-accept-button">Create</button>
			<button id="modal-cancel-button">Cancel</button>
		</div>
	</div>
</main>
